<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Precomputed mirroring</title>
  </head>
  <body>
    <div>
      <canvas id="myCanvas" width="800" height="500"></canvas>
    </div>
    <button onclick="normalFlip()">Normal mirroring</button>
    <button onclick="precomputedFlip()">Precomputed mirroring</button>
  </body>
  <script>
    const canvas = document.querySelector('canvas');
    const ctx = canvas.getContext('2d');

    let mirrorCanvas = document.createElement('canvas');
    mirrorCanvas.height = 500;
    let mCtx = mirrorCanvas.getContext('2d');
    let count = 0;
    const image = document.createElement('img');
    image.src = './doraemon_sprite.png';
    const width = 246;
    const height = 320;
    image.addEventListener('load', () => {
      ctx.drawImage(image, 0, 0, width, height, 0, 0, width, height);
      flipHorizontally(mCtx, width / 2);
      mCtx.drawImage(image, 0, 0, width, height, 0, 0, width, height);
    });

    function flipHorizontally(cx, around) {
      cx.translate(around, 0);
      cx.scale(-1, 1);
      cx.translate(-around, 0);
    }
    function normalFlip() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      flipHorizontally(ctx, width / 2);
      ctx.drawImage(image, 0, 0, width, height, 0, 0, width, height);
      count += 1;
    }
    function precomputedFlip() {
      if (count % 2 == 0) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(mirrorCanvas, 0, 0, width, height, 0, 0, width, height);
      } else {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(image, 0, 0, width, height, 0, 0, width, height);
      }
      count += 1;
    }
  </script>
</html>
